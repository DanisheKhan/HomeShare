<nav
  class="sticky top-0 bg-white shadow-navbar transition-all duration-300 py-2.5 px-4"
>
  <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between">
    <!-- Logo -->
    <a href="/listings" class="flex items-center space-x-2 group">
      <i
        class="fa-regular fa-compass text-2xl text-primary transition-transform duration-300 group-hover:rotate-12"
      ></i>
      <span
        class="font-bold text-xl text-primary group-hover:text-primaryDark transition-colors duration-300"
        >HomeShare</span
      >
    </a>

    <!-- Mobile menu button -->
    <button
      id="navbar-toggle"
      class="md:hidden p-2 rounded-md focus:outline-none"
      aria-label="Toggle navigation"
    >
      <i class="fa-solid fa-bars text-gray-600"></i>
    </button>

    <!-- Navigation container -->
    <div
      id="navbar-content"
      class="hidden w-full md:flex md:w-auto md:items-center md:justify-between md:flex-1"
    >
      <!-- Left Links -->
      <div class="md:flex md:items-center">
        <a
          href="/listings"
          class="block py-2 px-3 md:mr-4 text-gray-700 hover:text-primary relative group after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-primary after:transition-all after:duration-300 group-hover:after:w-full"
        >
          <i class="fa-solid fa-globe mr-1"></i> Explore
        </a>
      </div>

      <!-- Search -->
      <div class="w-full md:w-auto md:max-w-md md:mx-4 my-3 md:my-0">
        <form action="/listings" method="GET">
          <div class="relative flex items-center">
            <input
              type="search"
              name="search"
              placeholder="Search Destinations"
              aria-label="Search"
              class="w-full pl-4 pr-10 py-2 rounded-l-full border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            <button
              type="submit"
              class="absolute right-0 top-0 bottom-0 px-4 bg-primary text-white rounded-r-full hover:bg-primaryDark transition-all duration-300"
            >
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
          </div>
        </form>
      </div>

      <!-- Right Links -->
      <div
        class="flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-3"
      >
        <a
          href="/listings/new"
          class="block py-2 px-3 text-gray-700 hover:text-primary font-semibold transition-colors duration-300"
        >
          <i class="fa-solid fa-house-user mr-1"></i> Host Your Home
        </a>

        <% if (typeof currUser === 'undefined' || currUser === null) { %>
        <a
          href="/signup"
          class="block py-2 px-3 text-primary font-semibold hover:text-primaryDark transition-colors duration-300"
        >
          <i class="fa-solid fa-user-plus mr-1"></i> Signup
        </a>
        <a
          href="/login"
          class="block py-1.5 px-4 bg-primary text-white rounded-full font-semibold hover:bg-primaryDark transition-colors duration-300"
        >
          <i class="fa-solid fa-right-to-bracket mr-1"></i> Login
        </a>
        <% } else { %>
        <div class="relative" id="user-dropdown">
          <button
            class="flex items-center space-x-1 bg-gray-100 py-2 px-4 rounded-full border border-gray-200 hover:bg-gray-200 transition-all duration-300"
            id="user-menu-button"
            aria-expanded="false"
          >
            <i class="fa-regular fa-user"></i>
            <span class="ml-1">Account</span>
            <i class="fa-solid fa-chevron-down text-xs ml-1"></i>
          </button>

          <div
            id="dropdown-menu"
            class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 animate-fade-in-down"
          >
            <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
              <i class="fa-regular fa-id-card mr-2"></i>My Profile
            </a>
            <a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
              <i class="fa-solid fa-list mr-2"></i>My Listings
            </a>
            <div class="border-t border-gray-100 my-1"></div>
            <a
              href="/logout"
              class="block px-4 py-2 text-gray-700 hover:bg-gray-100"
            >
              <i class="fa-solid fa-sign-out-alt mr-2"></i>Logout
            </a>
          </div>
        </div>
        <% } %>
      </div>
    </div>
  </div>
</nav>

<style>
  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in-down {
    animation: fadeInDown 0.3s ease-out;
  }

  @media (max-width: 768px) {
    #navbar-content.show {
      display: flex;
      flex-direction: column;
      padding: 1rem 0;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Mobile menu toggle
    const navbarToggle = document.getElementById("navbar-toggle");
    const navbarContent = document.getElementById("navbar-content");

    navbarToggle.addEventListener("click", function () {
      if (navbarContent.classList.contains("hidden")) {
        navbarContent.classList.remove("hidden");
        navbarContent.classList.add("show", "flex", "flex-col");
      } else {
        navbarContent.classList.add("hidden");
        navbarContent.classList.remove("show", "flex", "flex-col");
      }
    });

    // User dropdown toggle
    const userDropdownButton = document.getElementById("user-menu-button");
    const dropdownMenu = document.getElementById("dropdown-menu");

    if (userDropdownButton && dropdownMenu) {
      userDropdownButton.addEventListener("click", function () {
        dropdownMenu.classList.toggle("hidden");

        // Update aria-expanded
        const expanded =
          userDropdownButton.getAttribute("aria-expanded") === "true";
        userDropdownButton.setAttribute("aria-expanded", !expanded);
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", function (event) {
        if (
          !userDropdownButton.contains(event.target) &&
          !dropdownMenu.contains(event.target)
        ) {
          dropdownMenu.classList.add("hidden");
          userDropdownButton.setAttribute("aria-expanded", "false");
        }
      });
    }

    // Scroll effect
    window.addEventListener("scroll", function () {
      const navbar = document.querySelector("nav");
      if (window.scrollY > 50) {
        navbar.classList.add("py-2", "shadow-lg");
        navbar.classList.remove("py-2.5", "shadow-navbar");
      } else {
        navbar.classList.remove("py-2", "shadow-lg");
        navbar.classList.add("py-2.5", "shadow-navbar");
      }
    });
  });
</script>
